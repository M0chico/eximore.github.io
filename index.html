<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Carte Interactive Multi-cartes</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #111;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #map-container {
      position: relative;
      width: 1000px;
      height: 700px;
      overflow: hidden;
    }

    #map {
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center center;
      width: 800px;
      height: 600px;
      transform-origin: 0 0;
      position: absolute;
    }

    .marker {
      position: absolute;
      font-size: 20px;
      cursor: pointer;
    }

    .marker[data-category="mob"]  { color: red; }
    .marker[data-category="quest"] { color: yellow; }
    .marker[data-category="ressource"] { color: lime; }
    .marker[data-category="lieu"] { color: cyan; }

    .marker:hover::after {
      content: attr(data-name) "\A‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\A" attr(data-description) "\A‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\A" attr(data-coords);
      white-space: pre;
      position: absolute;
      background: rgba(20,20,20,0.95);
      color: #eee;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #444;
      box-shadow: 0 0 10px rgba(0,0,0,0.8);
      top: 30px;
      left: 10px;
      width: 220px;
      z-index: 1000;
      font-size: 14px;
      font-family: monospace;
    }

    
    #sidebar {
      position: absolute;
      top: 0;
      left: 0;
      width: 250px;
      height: 100%;
      background: #222;
      padding: 10px;
      box-sizing: border-box;
      transition: transform 0.3s ease;
      z-index: 999;
    }

    #sidebar.collapsed {
      transform: translateX(-100%);
    }

    #toggle-btn {
      position: absolute;
      top: 10px;
      left: 260px;
      z-index: 1000;
      background: #444;
      color: white;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
    }

    input, select, button {
      width: 100%;
      padding: 5px;
      margin-top: 5px;
    }

    .filter-btn {
      margin-top: 5px;
      width: 100%;
    }

    #mod-code {
      position: absolute;
      bottom: 10px;
      left: 10px;
      width: 100px;
      z-index: 1000;
    }

    .mod-only {
      display: none;
    }
  </style>
</head>
<body>

<div id="sidebar">
  <h3>Choisir la carte (palier)</h3>
  <select id="map-selector" onchange="changeMap()">
    <option value="0">Palier 1</option>
    <option value="1">Palier 2</option>
    <option value="2">Palier 3</option>
    <option value="3">Palier 4</option>
    <option value="4">Palier 5</option>
    <option value="5">Palier 6</option>
    <option value="6">Palier 7</option>
    <option value="7">Palier 8</option>
    <option value="8">Palier 9</option>
    <option value="9">Palier 10</option>
    <option value="10">Palier 11</option>
    <option value="11">Palier 12</option>
    <option value="12">Palier 13</option>
    <option value="13">Palier 14</option>
    <option value="14">Palier 15</option>
    <option value="15">Palier 16</option>
    <option value="16">Palier 17</option>
    <option value="17">Palier 18</option>
    <option value="18">Palier 19</option>
    <option value="19">Palier 20</option>
    <option value="20">Palier 21</option>
    <option value="21">Palier 22</option>
    <option value="22">Palier 23</option>
    <option value="23">Palier 24</option>
    <option value="24">Palier 25</option>
  </select>
  <hr>

  <h3 class="mod-only">Ajouter un marqueur</h3>
  <input class="mod-only" id="name" placeholder="Nom" />
  <select class="mod-only" id="category">
    <option value="mob">Mob</option>
    <option value="quest">Qu√™te</option>
    <option value="ressource">Ressource</option>
    <option value="lieu">Lieu</option>
  </select>
  <input class="mod-only" id="description" placeholder="Description" />
  <input class="mod-only" id="coords" placeholder="Coordonn√©es (x y z)" />
  <button class="mod-only" onclick="enablePlacing()">Placer un marqueur</button>
  <button class="mod-only" onclick="exportMarkers()">Exporter JSON</button>
  <input type="file" onchange="importMarkers(event)" />
  <hr />
  <h4>Filtres :</h4>
  <button class="filter-btn" onclick="toggleCategory('mob')">Afficher/Masquer Mob</button>
  <button class="filter-btn" onclick="toggleCategory('quest')">Afficher/Masquer Qu√™te</button>
  <button class="filter-btn" onclick="toggleCategory('ressource')">Afficher/Masquer Ressource</button>
  <button class="filter-btn" onclick="toggleCategory('lieu')">Afficher/Masquer Lieu</button>
  <hr />
  <input id="search" placeholder="Rechercher..." oninput="filterMarkers()" />
  <button onclick="resetView()">üîÑ Recentrer</button>
</div>

<div id="toggle-btn" onclick="toggleSidebar()">‚â°</div>
<input id="mod-code" placeholder="Code admin" />
<div id="map-container">
  <div id="map"></div>
</div>

<script>
  const map = document.getElementById('map');
  const mapSelector = document.getElementById('map-selector');

  // Mets ici tes 25 URLs des cartes
  const mapUrls = [
    'carte1.png', // exemple palier 1
    'carte1.png',
    'carte3.png',
    'carte4.png',
    'carte5.png',
    'carte6.png',
    'carte7.png',
    'carte8.png',
    'carte9.png',
    'carte10.png',
    'carte11.png',
    'carte12.png',
    'carte13.png',
    'carte14.png',
    'carte15.png',
    'carte16.png',
    'carte17.png',
    'carte18.png',
    'carte19.png',
    'carte20.png',
    'carte21.png',
    'carte22.png',
    'carte23.png',
    'carte24.png',
    'carte25.png',
  ];
  
  let currentMapIndex = 0;
  let placing = false;
  let zoom = 1;
  let offsetX = 0;
  let offsetY = 0;
  let hiddenCategories = new Set();
  let markers = [];
  const icons = {
    mob: 'üê∫',
    quest: '‚ùó',
    ressource: '‚õèÔ∏è',
    lieu: 'üè†'
  };

  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('collapsed');
  }

  function enablePlacing() {
    placing = true;
  }

  function addMarker(x, y, name, category, description, coords = '') {
    const icon = icons[category] || '‚ùì';
    const el = document.createElement('div');
    el.className = 'marker';
    el.style.left = `${x}px`;
    el.style.top = `${y}px`;
    el.dataset.category = category;
    el.dataset.name = name.toLowerCase();
    el.dataset.description = description.toLowerCase();
    el.dataset.coords = coords;
    el.setAttribute('data-name', name);
    el.setAttribute('data-description', description);
    el.setAttribute('data-coords', coords);
    el.textContent = icon;
    el.addEventListener('contextmenu', e => {
      e.preventDefault();
      map.removeChild(el);
      markers = markers.filter(m => !(m.x === x && m.y === y && m.name === name));
      saveMarkers();
    });
    map.appendChild(el);
  }

  function loadMarkersForCurrentMap() {
    markers = [];
    map.innerHTML = '';
    if (allMarkers[currentMapIndex]) {
      markers = allMarkers[currentMapIndex];
      markers.forEach(m => addMarker(m.x, m.y, m.name, m.category, m.description, m.coords));
    }
  }

  function filterMarkers() {
    const query = document.getElementById('search').value.toLowerCase();
    document.querySelectorAll('.marker').forEach(el => {
      const match = el.dataset.name.includes(query) || el.dataset.description.includes(query);
      el.style.display = match ? 'block' : 'none';
    });
  }

  function toggleCategory(cat) {
    const elements = document.querySelectorAll(`.marker[data-category="${cat}"]`);
    if (hiddenCategories.has(cat)) {
      elements.forEach(el => el.style.display = 'block');
      hiddenCategories.delete(cat);
    } else {
      elements.forEach(el => el.style.display = 'none');
      hiddenCategories.add(cat);
    }
  }

  function resetView() {
    zoom = 1;
    offsetX = 0;
    offsetY = 0;
    map.style.transform = `translate(0px, 0px) scale(1)`;
  }

  function changeMap() {
    const select = document.getElementById('map-selector');
    currentMapIndex = parseInt(select.value);

    // Change le fond de la carte
    map.style.backgroundImage = `url('${mapUrls[currentMapIndex]}')`;

    // Recharge les marqueurs de la carte courante
    loadMarkersForCurrentMap();

    // Reset vue (optionnel)
    resetView();
  }

  map.addEventListener('click', function(e) {
    if (!placing) return;
    const rect = map.getBoundingClientRect();
    const x = (e.clientX - rect.left) / zoom;
    const y = (e.clientY - rect.top) / zoom;

    const name = document.getElementById('name').value;
    const category = document.getElementById('category').value;
    const description = document.getElementById('description').value;
    const coords = document.getElementById('coords').value;

    if (!name) {
      alert('Merci de saisir un nom pour le marqueur');
      return;
    }

    const markerData = { x, y, name, category, description, coords };
    markers.push(markerData);
    addMarker(x, y, name, category, description, coords);
    saveMarkers();
    placing = false;
  });

  map.addEventListener('wheel', function(e) {
    e.preventDefault();
    const rect = map.getBoundingClientRect();
    const mouseX = (e.clientX - rect.left);
    const mouseY = (e.clientY - rect.top);
    const prevZoom = zoom;
    const zoomAmount = e.deltaY < 0 ? 0.1 : -0.1;
    zoom = Math.min(3, Math.max(1, zoom + zoomAmount));

    const dx = mouseX / prevZoom;
    const dy = mouseY / prevZoom;
    offsetX -= dx * (zoom - prevZoom);
    offsetY -= dy * (zoom - prevZoom);
    map.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${zoom})`;
  }, { passive: false });

  function exportMarkers() {
    const blob = new Blob([JSON.stringify(markers, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'markers_palier_' + (currentMapIndex+1) + '.json';
    a.click();
    URL.revokeObjectURL(url);
  }

  function importMarkers(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        markers = JSON.parse(e.target.result);
        map.innerHTML = '';
        markers.forEach(m => addMarker(m.x, m.y, m.name, m.category, m.description, m.coords));
        saveMarkers();
      } catch (err) {
        alert("Fichier JSON invalide");
      }
    };
    reader.readAsText(file);
  }

// ‚úÖ Fonction pour charger automatiquement le fichier JSON
function loadMarkersFromFile() {
  fetch('marqueurs.json')
    .then(response => {
      if (!response.ok) throw new Error("Erreur lors du chargement du fichier JSON");
      return response.json();
    })
    .then(data => {
      markers = data;
      map.innerHTML = ''; // Vide la carte
      markers.forEach(m => addMarker(m.x, m.y, m.name, m.category, m.description, m.coords));
    })
    .catch(err => {
      alert("Impossible de charger les marqueurs : " + err.message);
    });
}

window.addEventListener('DOMContentLoaded', loadMarkersFromFile);


  
  document.getElementById('mod-code').addEventListener('change', function () {
    if (this.value === '6969') {
      document.querySelectorAll('.mod-only').forEach(el => el.style.display = 'block');
      this.style.display = 'none';
    } else {
      alert('Code incorrect');
    }
  });

  // Initialisation au chargement
  document.addEventListener('DOMContentLoaded', () => {
    map.style.backgroundImage = `url('${mapUrls[currentMapIndex]}')`;
    loadMarkersForCurrentMap();
  });
</script>

</body>
</html>